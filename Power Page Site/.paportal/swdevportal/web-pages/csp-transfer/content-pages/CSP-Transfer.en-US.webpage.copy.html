<div class="row sectionBlockLayout text-start" style="display: flex; flex-wrap: wrap; margin: 0px; min-height: auto; padding: 8px;">
  <div class="container" style="display: flex; flex-wrap: wrap;">
    <div class="col-lg-12 columnBlockLayout" style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px; padding: 16px; margin: 60px 0px;">
      <div id="csp-consent-panel" class="csp-consent-panel" style="padding: 20px 40px; margin-bottom: 30px;">
        <h2>CSP Transfer Request</h2>

        <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-bottom: 20px;">
          <p><strong>IMPORTANT</strong> - This form is not to be used for the new mid-term NCE CSP Transfer procedure recently made available by Microsoft. This procedure is being finalized by our team. We'll update this page as soon as this is available to use.</p>
          <p style="margin-bottom: 0;">You can still use this form for assistance in linking a tenant to an organization in your Sherweb Partner Portal and you can continue to process CSP Transfers in the existing way (adding new subscriptions with Sherweb, cancelling/expiring with existing CSP), but these requests should not be used for mid-term NCE transfers.</p>
        </div>

        <h3>Before proceeding, please confirm the following:</h3>

        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
          <p style="margin-bottom: 10px;"><strong>NCE Enforcement Policy:</strong></p>
          <p>Due to Microsoft's NCE enforcement policy, Sherweb will no longer be adding licenses on your behalf as part of this CSP transfer.</p>
          <p>For all organizations, we will link the Microsoft tenant to the Cumulus organization specified below, and disable Sherweb's License Management feature to allow the licenses to provision to the destination tenant.</p>
          <p>For Academic, Non-Profit or GCC organizations, we will also add the Segment Activation offer to enable the offer families in the organization.</p>
          <p style="margin-bottom: 0;"><em>With this change, you will now be responsible for the purchase/cancellation of the licenses.</em></p>
          <label style="display: block; margin-top: 15px; font-size: 16px;">
            <input type="checkbox" id="csp-nce-policy-checkbox" style="margin-right: 8px;" />
            I understand and wish to proceed.
          </label>
        </div>

        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
          <p style="margin-bottom: 10px;"><strong>Organization Created in Cumulus:</strong></p>
          <p>Did you create the new organization in Cumulus? If not, please create it before continuing.</p>
          <p style="margin-bottom: 0;"><a href="https://cumulus.sherweb.com" target="_blank">Access Cumulus Portal</a></p>
          <label style="display: block; margin-top: 15px; font-size: 16px;">
            <input type="checkbox" id="csp-org-created-checkbox" style="margin-right: 8px;" />
            The organization has been created in Cumulus.
          </label>
        </div>

        <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px;">
          <p style="margin-bottom: 10px;"><strong>Microsoft Customer Agreement (MCA):</strong></p>
          <p>Have you accepted the MCA (Microsoft Customer Agreement) for that organization?</p>
          <p style="margin-bottom: 0;"><em>If the MCA has not been accepted for this organization in Cumulus, we won't be able to proceed with your transfer request. If you need assistance, please reach out to the sales department by dialing +1 (888) 567-6610.</em></p>
          <label style="display: block; margin-top: 15px; font-size: 16px;">
            <input type="checkbox" id="csp-mca-accepted-checkbox" style="margin-right: 8px;" />
            The MCA has been accepted.
          </label>
        </div>

        <div class="csp-consent-actions" style="margin-top: 30px;">
          <button id="csp-consent-continue" disabled="" style="background-color: #ff6600; color: white; border: none; padding: 12px 32px; font-size: 16px; font-weight: bold; border-radius: 4px; cursor: pointer; transition: background-color 0.3s;">Continue to request form</button>
        </div>
      </div>

      <div id="csp-form-panel" style="display: none;">{% entityform name: 'CSP Transfer' %}</div>
    </div>
  </div>
</div>

{% fetchxml orgsQuery %}
<fetch>
  <entity name="revops_cumulusorganization">
    <attribute name="revops_cumulusorganizationid" />
    <attribute name="revops_name" />
    <link-entity name="revops_cumulusaccount" from="revops_cumulusaccountid" to="revops_cumulusaccount" link-type="outer" alias="account">
      <attribute name="revops_cumulusaccountid" />
      <attribute name="revops_name" />
    </link-entity>
    <filter type="and">
      <condition attribute="statecode" operator="eq" value="0" />
    </filter>
    <order attribute="revops_name" descending="false" />
  </entity>
</fetch>
{% endfetchxml %} {% fetchxml accountsQuery %}
<fetch top="5000">
  <entity name="revops_cumulusaccount">
    <attribute name="revops_cumulusaccountid" />
    <attribute name="revops_name" />
    <filter>
      <condition attribute="statecode" operator="eq" value="0" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %} {% fetchxml subjectQuery %}
<fetch top="1">
  <entity name="subject">
    <attribute name="subjectid" />
    <attribute name="title" />
    <filter>
      <condition attribute="title" operator="eq" value="CSP" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %} {% fetchxml serviceQuery %}
<fetch top="1">
  <entity name="revops_service">
    <attribute name="revops_serviceid" />
    <attribute name="revops_name" />
    <filter>
      <condition attribute="revops_name" operator="eq" value="Microsoft 365" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %} {% fetchxml queueQuery %}
<fetch top="1">
  <entity name="queue">
    <attribute name="queueid" />
    <attribute name="name" />
    <filter>
      <condition attribute="name" operator="eq" value="Technical Onboarding" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %}

<script id="csp-orgs-data" type="application/json">
  [
    {% assign orgs = orgsQuery.results.entities %}
    {% for org in orgs %}
    {
      "id": "{{ org.revops_cumulusorganizationid }}",
      "name": "{{ org.revops_name | escape }}",
      "cumulusAccountId": "{{ org['account.revops_cumulusaccountid'] }}",
      "cumulusAccountName": "{{ org['account.revops_name'] | escape }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
</script>

<script id="csp-accounts-data" type="application/json">
  [
    {% assign accounts = accountsQuery.results.entities %}
    {% for account in accounts %}
    {
      "id": "{{ account.revops_cumulusaccountid }}",
      "name": "{{ account.revops_name | escape }}"
    }{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
</script>

<script id="csp-config-data" type="application/json">
  {
    "subjectId": "{% if subjectQuery.results.entities.size > 0 %}{{ subjectQuery.results.entities[0].subjectid }}{% endif %}",
    "subjectName": "{% if subjectQuery.results.entities.size > 0 %}{{ subjectQuery.results.entities[0].title }}{% endif %}",
    "serviceId": "{% if serviceQuery.results.entities.size > 0 %}{{ serviceQuery.results.entities[0].revops_serviceid }}{% endif %}",
    "serviceName": "{% if serviceQuery.results.entities.size > 0 %}{{ serviceQuery.results.entities[0].revops_name }}{% endif %}",
    "queueId": "{% if queueQuery.results.entities.size > 0 %}{{ queueQuery.results.entities[0].queueid }}{% endif %}",
    "queueName": "{% if queueQuery.results.entities.size > 0 %}{{ queueQuery.results.entities[0].name }}{% endif %}"
  }
</script>
