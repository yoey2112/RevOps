{% if user %}
<!-- Fetch TSS Management queue for escalate form -->
{% fetchxml escalate_queue_lookup %}
<fetch top="1">
  <entity name="queue">
    <attribute name="queueid" />
    <attribute name="name" />
    <filter>
      <condition attribute="name" operator="eq" value="TSS Management" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %}
{% assign escalate_queue_id = escalate_queue_lookup.results.entities[0].queueid %}
{% assign escalate_queue_name = escalate_queue_lookup.results.entities[0].name %}

<!-- Fetch all cases without escalation reason for validation -->
{% fetchxml valid_cases %}
<fetch>
  <entity name="incident">
    <attribute name="incidentid" />
    <filter type="and">
      <condition attribute="statecode" operator="eq" value="0" />
      <condition attribute="revops_customerescalationreason" operator="null" />
    </filter>
  </entity>
</fetch>
{% endfetchxml %}

<script id="valid-cases-data" type="application/json">
{
  "validCaseIds": [
    {% for case in valid_cases.results.entities -%}
      {% assign clean_id = case.incidentid | replace: '{', '' | replace: '}', '' | downcase -%}
      "{{ clean_id }}"{% unless forloop.last %},{% endunless %}
    {% endfor %}
  ]
}
</script>

<script id="escalate-queue-data" type="application/json">
{
  "queueId": "{{ escalate_queue_id | escape }}",
  "queueName": "{{ escalate_queue_name | escape }}"
}
</script>

<style>
  tr.queue-hidden, td.queue-hidden {
    display: none !important;
  }
</style>
{% endif %}

<div class="row sectionBlockLayout text-start" style="display: flex; flex-wrap: wrap; margin: 0px; min-height: auto; padding: 8px;">
  <div class="container" style="padding: 0px; display: flex; flex-wrap: wrap;"><div class="col-lg-12 columnBlockLayout" style="flex-grow: 1; display: flex; flex-direction: column; min-width: 250px;">{% entityform name: 'View - Client Case' %}</div></div>
</div>
<fieldset aria-label="Overview">
  <table role="presentation" data-name="{51999b68-4b4c-439b-bb51-1b49edae03a9}" class="section">
    <colgroup>
      <col style="width: 100%;" />
    </colgroup>
    <tbody>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
      <tr></tr>
    </tbody>
  </table>
</fieldset>
